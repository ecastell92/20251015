# ============================================================================
# Ejemplo completo de configuración (terraform.tfvars)
# ============================================================================

# --- Básicos ---
aws_region         = "eu-west-1"
environment        = "dev"           # dev|staging|prod
tenant             = "00"
iniciativa         = "mvp"
cuenta             = "123456789012"
central_backup_vault_name = "00-dev-aws-vault-bck-001"
sufijo_recursos           = "bck-001"

# --- Schedules por criticidad ---
schedule_expressions = {
  Critico = {
    incremental = "rate(12 hours)"
    sweep       = "rate(7 days)"
    grandfather = "cron(0 3 1 * ? *)"
  }
  MenosCritico = {
    incremental = "rate(24 hours)"
    sweep       = "rate(14 days)"
    grandfather = "cron(0 3 1 * ? *)"
  }
  NoCritico = {
    sweep = "rate(30 days)"
  }
}

# --- GFS por criticidad ---
gfs_rules = {
  Critico = {
    enable                     = true
    start_storage_class        = "GLACIER_IR"
    son_retention_days         = 14
    father_da_days             = 0
    father_retention_days      = 28
    father_archive_class       = "DEEP_ARCHIVE"
    grandfather_da_days        = 90
    grandfather_retention_days = 365
    grandfather_archive_class  = "DEEP_ARCHIVE"
  }
  MenosCritico = {
    enable                     = true
    start_storage_class        = "GLACIER_IR"
    son_retention_days         = 7
    father_da_days             = 0
    father_retention_days      = 28
    father_archive_class       = "DEEP_ARCHIVE"
    grandfather_da_days        = 90
    grandfather_retention_days = 365
    grandfather_archive_class  = "DEEP_ARCHIVE"
  }
  NoCritico = {
    enable                     = true
    start_storage_class        = "GLACIER"
    son_retention_days         = 0
    father_da_days             = 0
    father_retention_days      = 30
    father_archive_class       = "GLACIER"
    grandfather_da_days        = 0
    grandfather_retention_days = 0
    grandfather_archive_class  = "GLACIER"
  }
}

# --- Filtros y controles para incrementales ---
criticality_tag        = "BackupCriticality"
allowed_prefixes       = { Critico = [], MenosCritico = [], NoCritico = [] }
exclude_key_prefixes   = ["temporary/", "sparkHistoryLogs/"]
exclude_key_suffixes   = [".inprogress", "/"]
force_full_on_first_run     = false
fallback_max_objects        = 0
fallback_time_limit_seconds = 0
disable_window_checkpoint   = true
incremental_log_level       = "INFO"

# --- KMS en origen ---
kms_allow_viaservice = true
source_kms_key_arns  = []  # o lista de ARNs si quieres restringir

# --- Limpieza operacional (Lifecycle) ---
cleanup_inventory_source_days = 7
cleanup_batch_reports_days    = 7
cleanup_checkpoints_days      = 7
cleanup_manifests_temp_days   = 7
cleanup_configurations_days   = 90

# --- Backup de configuraciones (toggles) ---
backup_config_log_level        = "INFO"
backup_config_tag_filter_key   = "BackupEnabled"
backup_config_tag_filter_value = "true"
backup_config_include_glue          = true
backup_config_include_athena        = true
backup_config_include_lambda        = true
backup_config_include_iam           = true
backup_config_include_stepfunctions = true
backup_config_include_eventbridge   = true
backup_config_include_dynamodb      = false
backup_config_include_rds           = false

# --- Seleccion de servicios a desplegar ---
# Pipeline S3 (Lambdas + Step Functions + Scheduler)
enable_s3_backups     = true
# Bucket central de S3 (si solo usas RDS/DynamoDB puedes poner false)
enable_central_bucket = true

# --- Seguridad (opcionales) ---
min_deep_archive_offset_days = 90
enable_object_lock           = false
object_lock_mode             = "COMPLIANCE"
object_lock_retention_days   = 0
deny_delete_enabled          = false
allow_delete_principals      = []
require_mfa_for_delete       = false

# --- Tags globales ---
backup_tags = {
  ManagedBy    = "Terraform"
  Project      = "S3BackupOptimized"
  Environment  = "dev"
  Initiative   = "mvp"
}
